<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="本文介绍了如何在asp.net core中，访问有权限控制的远程文件夹内容。">
<meta name="keywords" content="Asp.net core">
<meta property="og:type" content="article">
<meta property="og:title" content="Asp.net Core访问远程文件夹">
<meta property="og:url" content="http://yoursite.com/2018/09/05/Asp-net-Core访问远程文件夹/index.html">
<meta property="og:site_name" content="Ainslee">
<meta property="og:description" content="本文介绍了如何在asp.net core中，访问有权限控制的远程文件夹内容。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2018/09/05/Asp-net-Core访问远程文件夹/access_remote_identity_config.png">
<meta property="og:image" content="http://yoursite.com/2018/09/05/Asp-net-Core访问远程文件夹/access_remote_file.png">
<meta property="og:updated_time" content="2018-09-14T10:06:40.914Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Asp.net Core访问远程文件夹">
<meta name="twitter:description" content="本文介绍了如何在asp.net core中，访问有权限控制的远程文件夹内容。">
<meta name="twitter:image" content="http://yoursite.com/2018/09/05/Asp-net-Core访问远程文件夹/access_remote_identity_config.png">






  <link rel="canonical" href="http://yoursite.com/2018/09/05/Asp-net-Core访问远程文件夹/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Asp.net Core访问远程文件夹 | Ainslee</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ainslee</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签<span class="badge">6</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类<span class="badge">4</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档<span class="badge">12</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/05/Asp-net-Core访问远程文件夹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fatpanda">
      <meta itemprop="description" content="岂能尽如人意，但求无愧于心。">
      <meta itemprop="image" content="/images/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ainslee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Asp.net Core访问远程文件夹
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-05 14:23:56" itemprop="dateCreated datePublished" datetime="2018-09-05T14:23:56+08:00">2018-09-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-09-14 18:06:40" itemprop="dateModified" datetime="2018-09-14T18:06:40+08:00">2018-09-14</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Asp-net-core/" itemprop="url" rel="index"><span itemprop="name">Asp.net core</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/05/Asp-net-Core访问远程文件夹/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/09/05/Asp-net-Core访问远程文件夹/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/09/05/Asp-net-Core访问远程文件夹/" class="leancloud_visitors" data-flag-title="Asp.net Core访问远程文件夹">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          
              <div class="post-description">本文介绍了如何在asp.net core中，访问有权限控制的远程文件夹内容。</div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>最近在使用asp.net core开发项目，系统应用部署在A服务器，上传文件放在一台远程共享文件服务器B中（\\10.1.0.10）。</p>
<p>参考以前asp.net的项目经验，可以在IIS中创建虚拟目录files(如果有权限控制，虚拟目录还需要添加权限账号)指向文件服务器B，然后使用以下代码获取物理路径：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var physicalPath=Server.MapPath(<span class="string">"/files"</span>);</span><br></pre></td></tr></table></figure></p>
<p>但是，在.net core中，我们发现已经没有<code>Server.MapPath()</code>方法了。当我们需要获取物理路径时，通常是通过注入<code>IHostingEnvironment</code>，然后使用<code>_hostEnvironment.WebRootPath</code>来获取站点的默认文件根路径(wwwroot)。</p>
<p>那么，可以像asp.net一样，通过虚拟目录访问远程文件服务器文件么？  </p>
<p>答案是不能！我找到一篇资料：<a href="https://www.jauernig-it.de/asp-net-coreiis-serving-content-from-a-file-share/" target="_blank" rel="noopener">ASP.NET Core/IIS: serving content from a file share</a></p>
<blockquote>
<p>There are situations, when you want to serve static content with your application, that is not part of it, e.g. because it exists on a common file share. Website content, that is managed by a business division, could be such a use case. In ASP.NET before Core, this was no problem in IIS: just create a virtual directory within your IIS website and point it to the file share.</p>
<p>Unfortunately, with ASP.NET Core, this approach isn’t working any longer. If you add a virtual directory to your ASP.NET Core application in IIS, it isn’t recognized and a 404 is returned. It’s because of DNX/Kestrel, which is running beneath IIS (using the HttpPlatformHandler module) and to which IIS only brokers the requests. Kestrel doesn’t know anything of virtual directories from IIS. And because ASP.NET Core applications are independent from IIS and could also be run without it (e.g. running Kestrel standalone), that should be considered as a good thing.</p>
</blockquote>
<p>.net core为了跨平台，可以寄宿在任何宿主中，IIS仅仅是作为反向代理来处理请求，所以Kestrel是不知道来自IIS虚拟目录的任何内容的。</p>
<p>既然使用虚拟目录的方式不行，那还有其他什么办法呢？</p>
<p>通过搜索，我看到微软官方的一篇文章，介绍如何指定静态文件路径：<a href="&quot;https://docs.microsoft.com/en-us/aspnet/core/fundamentals/static-files?view=aspnetcore-2.1&amp;tabs=aspnetcore2x&quot;">Static files in ASP.NET Core</a>，可简单在<code>Startup.cs</code>的<code>Configure</code>配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span><span class="params">(IApplicationBuilder app)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    app.UseStaticFiles();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加远程文件目录的访问</span></span><br><span class="line">    app.UseStaticFiles(<span class="keyword">new</span> StaticFileOptions()</span><br><span class="line">    &#123;</span><br><span class="line">        FileProvider = <span class="keyword">new</span> PhysicalFileProvider(@<span class="string">"\\10.1.0.10\files"</span>),</span><br><span class="line">        RequestPath = <span class="string">"/files"</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>app.UseStaticFiles()</code>可以使用多个，其中无参数的默认指向wwwroot文件夹。</p>
<p>运行程序，很不幸的是，系统直接抛出一个异常：</p>
<blockquote>
<p>System.ArgumentException:“The directory name \10.1.0.10\files\ is invalid.”</p>
</blockquote>
<p><strong>原因是文件夹有权限控制，无法直接访问。</strong></p>
<p>继续查资料，在stackoverflow看到这么一条回复：<a href="https://stackoverflow.com/questions/1496068/asp-net-read-files-from-a-password-protected-network-share" target="_blank" rel="noopener">ASP.NET Read Files from a Password Protected Network Share
</a>，里面提到可以使用<a href="https://docs.microsoft.com/en-us/windows/desktop/api/winnetwk/nf-winnetwk-wnetaddconnection2a" target="_blank" rel="noopener">WNetAddConnection2</a>建立远程文件目录映射。</p>
<p>这里我们可以看一下微软对<code>WNetAddConnection2</code>的描述：</p>
<blockquote>
<p>The WNetAddConnection2 function makes a connection to a network resource and can redirect a local device to the network resource.</p>
</blockquote>
<p>意思是说，WNetAddConnection2方法可以建立网络资源链接，并且将一个本地驱动到重定向到网络资源。(简单来说就是可以映射网络驱动器)</p>
<p>修改Configure代码（此处仅给出Configure中部分代码，其他的注入按实际项目添加。）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span><span class="params">(IApplicationBuilder app)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    app.UseStaticFiles();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加网络隐射</span></span><br><span class="line">    var result = Drived.NetworkConnection.Connect(<span class="string">"\\10.1.0.10\files"</span>,</span><br><span class="line">                                    <span class="string">"P:"</span>,</span><br><span class="line">                                    <span class="string">"userAccount"</span>,</span><br><span class="line">                                    <span class="string">"password"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result != <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> Exception($<span class="string">"远程文件目录映射失败！返回结果：&#123;result&#125;"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加远程文件目录的访问</span></span><br><span class="line">    app.UseStaticFiles(<span class="keyword">new</span> StaticFileOptions()</span><br><span class="line">    &#123;</span><br><span class="line">        FileProvider = <span class="keyword">new</span> PhysicalFileProvider(ReportSettings.RemoteFileMap),</span><br><span class="line">        RequestPath = <span class="string">"/files"</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p><em><code>Drived.NetworkConnection</code>完整代码贴在最后</em></p>
<p>运行程序，很不幸抛出异常：‘远程文件目录映射失败！返回结果：1312’。我们来看看1312错误究竟是个什么鬼，参考微软官方文档的描述：<a href="https://docs.microsoft.com/zh-cn/windows/desktop/Debug/system-error-codes" target="_blank" rel="noopener">System Error Codes</a></p>
<blockquote>
<p>1312 (0x520)  </p>
<p>A specified logon session does not exist. It may already have been terminated.</p>
</blockquote>
<p>登录会话不存在？因为我在本机开发环境运行，已经能够正常访问。猜测是程序发布到IIS后，IIS程序池无权限的问题。</p>
<p>设置IIS站点应用权限</p>
<blockquote>
<p>IIS-&gt;应用程序池-&gt;当前站点的程序-&gt;高级设置</p>
</blockquote>
<img src="/2018/09/05/Asp-net-Core访问远程文件夹/access_remote_identity_config.png">
<p>配置完成后，重启应用程序池。再次运行，访问<code>http://localhost:62144/files/test.png</code>，结果如下：</p>
<img src="/2018/09/05/Asp-net-Core访问远程文件夹/access_remote_file.png">
<p>以下是<code>Drived.NetworkConnection</code>的完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Drived</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> ERROR_ID</span><br><span class="line">    &#123;</span><br><span class="line">        ERROR_SUCCESS = <span class="number">0</span>,  <span class="comment">// Success </span></span><br><span class="line">        ERROR_ACCESS_DENIED = <span class="number">5</span>,</span><br><span class="line">        ERROR_NOT_ENOUGH_MEMORY = <span class="number">8</span>,</span><br><span class="line">        ERROR_READ_FAULT = <span class="number">30</span>,</span><br><span class="line">        Windows_cannot_find_the_network_path = <span class="number">51</span>,</span><br><span class="line">        ERROR_BAD_NETPATH = <span class="number">53</span>,</span><br><span class="line">        ERROR_NETWORK_BUSY = <span class="number">54</span>,</span><br><span class="line">        ERROR_NETWORK_ACCESS_DENIED = <span class="number">65</span>,</span><br><span class="line">        ERROR_BAD_DEV_TYPE = <span class="number">66</span>,</span><br><span class="line">        ERROR_BAD_NET_NAME = <span class="number">67</span>,</span><br><span class="line">        ERROR_REQ_NOT_ACCEP = <span class="number">71</span>,</span><br><span class="line">        ERROR_ALREADY_ASSIGNED = <span class="number">85</span>,</span><br><span class="line">        ERROR_INVALID_PASSWORD = <span class="number">86</span>,</span><br><span class="line">        ERROR_INVALID_PARAMETER = <span class="number">87</span>,</span><br><span class="line">        ERROR_OPEN_FAILED = <span class="number">110</span>,</span><br><span class="line">        ERROR_INVALID_LEVEL = <span class="number">124</span>,</span><br><span class="line">        ERROR_BUSY = <span class="number">170</span>,</span><br><span class="line">        ERROR_MORE_DATA = <span class="number">234</span>,</span><br><span class="line">        ERROR_NO_BROWSER_SERVERS_FOUND = <span class="number">6118</span>,</span><br><span class="line">        ERROR_NO_NETWORK = <span class="number">1222</span>,</span><br><span class="line">        ERROR_INVALID_HANDLE_STATE = <span class="number">1609</span>,</span><br><span class="line">        ERROR_EXTENDED_ERROR = <span class="number">1208</span>,</span><br><span class="line">        ERROR_DEVICE_ALREADY_REMEMBERED = <span class="number">1202</span>,</span><br><span class="line">        ERROR_NO_NET_OR_BAD_PATH = <span class="number">1203</span>,</span><br><span class="line">        the_user_has_not_been_granted_the_requested_logon_type_at_this_computer = <span class="number">1385</span>,</span><br><span class="line">        unknown_user_name_or_bad_password = <span class="number">1326</span>,</span><br><span class="line">        ERROR_ACCOUNT_RESTRICTION = <span class="number">1327</span>,</span><br><span class="line">        ERROR_INVALID_WORKSTATION = <span class="number">1329</span>,</span><br><span class="line">        logon_request_contained_an_invalid_logon_type_value = <span class="number">1367</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> RESOURCE_SCOPE</span><br><span class="line">    &#123;</span><br><span class="line">        RESOURCE_CONNECTED = <span class="number">1</span>,</span><br><span class="line">        RESOURCE_GLOBALNET = <span class="number">2</span>,</span><br><span class="line">        RESOURCE_REMEMBERED = <span class="number">3</span>,</span><br><span class="line">        RESOURCE_RECENT = <span class="number">4</span>,</span><br><span class="line">        RESOURCE_CONTEXT = <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> RESOURCE_TYPE</span><br><span class="line">    &#123;</span><br><span class="line">        RESOURCETYPE_ANY = <span class="number">0</span>,</span><br><span class="line">        RESOURCETYPE_DISK = <span class="number">1</span>,</span><br><span class="line">        RESOURCETYPE_PRINT = <span class="number">2</span>,</span><br><span class="line">        RESOURCETYPE_RESERVED = <span class="number">8</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> RESOURCE_USAGE</span><br><span class="line">    &#123;</span><br><span class="line">        RESOURCEUSAGE_CONNECTABLE = <span class="number">1</span>,</span><br><span class="line">        RESOURCEUSAGE_CONTAINER = <span class="number">2</span>,</span><br><span class="line">        RESOURCEUSAGE_NOLOCALDEVICE = <span class="number">4</span>,</span><br><span class="line">        RESOURCEUSAGE_SIBLING = <span class="number">8</span>,</span><br><span class="line">        RESOURCEUSAGE_ATTACHED = <span class="number">16</span>,</span><br><span class="line">        RESOURCEUSAGE_ALL = (RESOURCEUSAGE_CONNECTABLE </span><br><span class="line">                            | RESOURCEUSAGE_CONTAINER </span><br><span class="line">                            | RESOURCEUSAGE_ATTACHED),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> RESOURCE_DISPLAYTYPE</span><br><span class="line">    &#123;</span><br><span class="line">        RESOURCEDISPLAYTYPE_GENERIC = <span class="number">0</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_DOMAIN = <span class="number">1</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_SERVER = <span class="number">2</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_SHARE = <span class="number">3</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_FILE = <span class="number">4</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_GROUP = <span class="number">5</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_NETWORK = <span class="number">6</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_ROOT = <span class="number">7</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_SHAREADMIN = <span class="number">8</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_DIRECTORY = <span class="number">9</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_TREE = <span class="number">10</span>,</span><br><span class="line">        RESOURCEDISPLAYTYPE_NDSCONTAINER = <span class="number">11</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [StructLayout(LayoutKind.Sequential)]</span><br><span class="line">    <span class="keyword">public</span> struct NETRESOURCE</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> RESOURCE_SCOPE dwScope;</span><br><span class="line">        <span class="keyword">public</span> RESOURCE_TYPE dwType;</span><br><span class="line">        <span class="keyword">public</span> RESOURCE_DISPLAYTYPE dwDisplayType;</span><br><span class="line">        <span class="keyword">public</span> RESOURCE_USAGE dwUsage;</span><br><span class="line"></span><br><span class="line">        [MarshalAs(UnmanagedType.LPStr)]</span><br><span class="line">        <span class="keyword">public</span> string lpLocalName;</span><br><span class="line"></span><br><span class="line">        [MarshalAs(UnmanagedType.LPStr)]</span><br><span class="line">        <span class="keyword">public</span> string lpRemoteName;</span><br><span class="line"></span><br><span class="line">        [MarshalAs(UnmanagedType.LPStr)]</span><br><span class="line">        <span class="keyword">public</span> string lpComment;</span><br><span class="line"></span><br><span class="line">        [MarshalAs(UnmanagedType.LPStr)]</span><br><span class="line">        <span class="keyword">public</span> string lpProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetworkConnection</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        [DllImport(<span class="string">"mpr.dll"</span>)]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> extern <span class="keyword">int</span> <span class="title">WNetAddConnection2</span><span class="params">(NETRESOURCE[] lpNetResource, </span></span></span><br><span class="line"><span class="function"><span class="params">                                string lpPassword, string lpUserName, <span class="keyword">int</span> dwFlags)</span></span>;</span><br><span class="line"></span><br><span class="line">        [DllImport(<span class="string">"mpr.dll"</span>)]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> extern <span class="keyword">int</span> <span class="title">WNetCancelConnection2</span><span class="params">(string sharename, <span class="keyword">int</span> dwFlags, <span class="keyword">int</span> fForce)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Connect</span><span class="params">(string remotePath, string localPath, string username, string password)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            NETRESOURCE[] share_driver = <span class="keyword">new</span> NETRESOURCE[<span class="number">1</span>];</span><br><span class="line">            share_driver[<span class="number">0</span>].dwScope = RESOURCE_SCOPE.RESOURCE_GLOBALNET;</span><br><span class="line">            share_driver[<span class="number">0</span>].dwType = RESOURCE_TYPE.RESOURCETYPE_DISK;</span><br><span class="line">            share_driver[<span class="number">0</span>].dwDisplayType = RESOURCE_DISPLAYTYPE.RESOURCEDISPLAYTYPE_SHARE;</span><br><span class="line">            share_driver[<span class="number">0</span>].dwUsage = RESOURCE_USAGE.RESOURCEUSAGE_CONNECTABLE;</span><br><span class="line">            share_driver[<span class="number">0</span>].lpLocalName = localPath;</span><br><span class="line">            share_driver[<span class="number">0</span>].lpRemoteName = remotePath;</span><br><span class="line"></span><br><span class="line">            Disconnect(localPath);</span><br><span class="line">            <span class="keyword">int</span> ret = WNetAddConnection2(share_driver, password, username, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Disconnect</span><span class="params">(string localpath)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> WNetCancelConnection2(localpath, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Asp-net-core/" rel="tag"># Asp.net core</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/02/ids4_6_使用OpenID-Connect添加用户认证/" rel="next" title="Asp.net Core身份认证框架IdentityServer4（6）使用OpenID Connect添加用户认证">
                <i class="fa fa-chevron-left"></i> Asp.net Core身份认证框架IdentityServer4（6）使用OpenID Connect添加用户认证
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/08/ids4_7_切换到混合流并添加API访问/" rel="prev" title="Asp.net Core身份认证框架IdentityServer4（7）切换到混合流并添加API访问">
                Asp.net Core身份认证框架IdentityServer4（7）切换到混合流并添加API访问 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/header.jpg"
                alt="Fatpanda" />
            
              <p class="site-author-name" itemprop="name">Fatpanda</p>
              <p class="site-description motion-element" itemprop="description">岂能尽如人意，但求无愧于心。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fatpanda</span>

  

  
</div>











        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


















  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'DowwEbHFSgFNCuLAvg9uaO6A-gzGzoHsz',
        appKey: 'Aa0TLy6wVuN4f4XPunLpvpj7',
        placeholder: '请留下你的评论...',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: true
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
